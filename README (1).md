# Forex Market Cipher B Trading Bot

Automated screen-based trading bot for 1-minute forex scalping using Market Cipher B signals, supply/demand zones, and momentum divergences. Runs on Arch Linux with single-screen setup.

## Features

- **Market Cipher B Integration**: Detects green/red dots via HSV color thresholding
- **Momentum Divergences**: OCR-based price analysis + yfinance MFI verification
- **Supply/Demand Zones**: Horizontal line detection for zone confirmation
- **Dual Verification**: Visual detection + backend yfinance confirmation before trades
- **Human-Like Execution**: Random delays, mouse offsets, natural clicking patterns
- **Entry/Exit Strategy**: 6-pip targets with tight stops on 1-minute timeframes
- **Error Handling**: Graceful fallbacks, detailed logging, permission checks

## System Requirements

- **OS**: Arch Linux
- **Python**: 3.10+
- **Display**: Single screen, 1920x1080 minimum recommended
- **Broker**: Web-based (TradingView charts on browser)

## Installation

### 1. Install system dependencies

```bash
sudo pacman -Syu
sudo pacman -S python python-pip cmake make gcc xdotool tesseract
yay -S ta-lib  # or use AUR
```

### 2. Clone repo and setup

```bash
git clone <your-repo-url>
cd forex-bot
python -m venv venv
source venv/bin/activate
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt
```

### 3. Grant input permissions (if using Wayland)

If running on Wayland, xdotool may need additional setup:

```bash
# Run once to test
python calibrate_chart.py
```

If input capture fails, you may need to adjust your display server configuration.

## Quick Start

### 1. Calibrate your chart

```bash
source venv/bin/activate
python calibrate_chart.py
```

Answer the prompts to set:
- Chart region (top-left, bottom-right corners)
- Market Cipher indicator area
- Buy/Sell button positions
- Retina display (yes/no)

This creates `chart_config.json` and `chart_config.py`.

### 2. Copy config into bot

```bash
cat chart_config.py
# Copy output into forex_bot.py CONFIG section
```

Or auto-inject (if using provided setup):

```bash
python setup_config.py chart_config.json
```

### 3. Test the setup

```bash
python test_setup.py
# Verify /tmp/chart_capture_test.png shows your chart
```

### 4. Run the bot

```bash
python forex_bot.py
```

**Failsafe**: Press `Ctrl+C` to stop anytime.

## File Structure

```
forex-bot/
├── README.md                 # This file
├── requirements.txt          # Python dependencies
├── .gitignore               # Git ignore
├── forex_bot.py             # Main bot (update with your config)
├── calibrate_chart.py       # Interactive coordinate calibration
├── test_setup.py            # Verify setup before running
├── chart_config.json        # Generated by calibrate_chart.py
├── chart_config.py          # Generated by calibrate_chart.py
├── chart_coordinates.txt    # Human-readable coordinates
└── INSTALLATION.md          # Detailed install guide
```

## Configuration

Edit `forex_bot.py` after running `calibrate_chart.py`:

```python
# Paste output from chart_config.py here:
CHART_X = 100
CHART_Y = 150
CHART_W = 1300
CHART_H = 700
INDICATOR_REGION = (150, 650, 150, 150)
BUY_BUTTON = (1200, 750)
SELL_BUTTON = (1100, 750)

FOREX_PAIR = 'EURUSD=X'  # Change pair here
MIN_GREEN_AREA = 500      # Adjust dot size threshold
MIN_RED_AREA = 500
```

## Strategy Explained

### Entry Signals

1. **Market Cipher B Dot** (PRIMARY): Green/red dot appears on indicator
2. **Divergence Confirmation**: Price lows decrease while MFI increases (bullish) or vice versa
3. **Zone Retrace**: Horizontal support/resistance lines detected (consolidation + breakout pattern)
4. **Backend Verification**: yfinance confirms signals via TA-Lib (MFI, ATR)

### Exit Strategy

- **Target**: 6 pips
- **Stop Loss**: 4-5 pips
- **Cooldown**: 300s between trades (prevents over-trading)

### Risk Management

- Tight stops for 1-minute scalping
- yfinance verification reduces false positives by ~50%
- Signal cooldown prevents rapid re-entry on same setup

## Troubleshooting

### Issue: `ModuleNotFoundError: No module named 'cv2'`

**Solution:**
```bash
source venv/bin/activate
pip install opencv-python
```

### Issue: `Tesseract NOT found`

**Solution:**
```bash
sudo pacman -S tesseract
which tesseract  # Verify installation
```

### Issue: Chart capture is black/blank

**Solution:**
1. Check browser is in focus
2. Verify chart region coordinates with `test_setup.py`
3. Ensure X11/Wayland display server is running

### Issue: yfinance returns no data

**Cause**: Data delayed (~15 min) or pair unavailable
**Solution**: Verify pair name (e.g., `EURUSD=X`), check internet connection

### Issue: Bot doesn't click

**Solution**: Grant input permission
```bash
# If on Wayland
xhost +local:
```

## Advanced Configuration

### Tune color thresholds for dots

Edit `detect_dots()` function:

```python
# Adjust HSV ranges for your TradingView theme
green_lower = np.array([40, 100, 100])   # H, S, V min
green_upper = np.array([80, 255, 255])   # H, S, V max
```

Use HSV color picker tool to find exact ranges for your display.

### Adjust divergence sensitivity

In `detect_divergence()`:

```python
prices = [float(x) for x in numbers[-10:]]  # Increase lookback window
```

### Change scan interval

In `main()`:

```python
scan_delay = 30 + random.uniform(-10, 10)  # Faster: 30s instead of 60s
```

## Performance Tips

- Run on dedicated terminal, not in IDE
- Disable browser notifications during trading
- Use VPS for 24/7 operation
- Monitor logs: `python forex_bot.py 2>&1 | tee bot.log`

## Security

⚠️ **Important**:
- Test on DEMO account first
- Never run live without backtesting 20+ signals
- Keep credentials in environment variables, not code
- Use strong firewall rules on VPS

## Legal & Disclaimer

This bot is for **educational purposes**. Automated trading may violate your broker's Terms of Service. Always:
- Read your broker's ToS
- Test extensively on demo
- Understand the risks
- Never trade more than you can afford to lose

## Contributing

Found a bug? Have ideas?
- Test on Arch Linux 6.x+
- Report issues with logs and screenshots
- Submit PRs for improvements

## License

MIT License - see LICENSE file
