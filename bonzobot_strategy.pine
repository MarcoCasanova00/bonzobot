// ============================================================================
// BONZOBOT TRADINGVIEW STRATEGY - Based on Market Cipher B by WeloTrades
// ============================================================================
// This strategy uses the EXACT same signal logic as the WeloTrades MCB indicator.
// GREEN DOT = Bullish Cross (wt1 crosses above wt2)
// RED DOT = Bearish Cross (wt1 crosses below wt2)
//
// Settings: BTCUSD, 0.02 units, 6-tick TP, 4-tick SL, 1-minute candles
// ============================================================================

//@version=5
strategy("Bonzobot MCB Strategy", overlay=false, default_qty_type=strategy.fixed, default_qty_value=0.02)

// ============================================================================
// INPUTS
// ============================================================================
takeProfitTicks = input.int(6, "Take Profit (ticks)", minval=1)
stopLossTicks = input.int(4, "Stop Loss (ticks)", minval=1)
orderSize = input.float(0.02, "Order Size (units)", minval=0.001, step=0.001)

// ============================================================================
// WAVE TREND CHANNEL SETTINGS (Exact same as WeloTrades MCB)
// ============================================================================
ap = input(close, title="Source")
n1 = input(9, "WT Channel Length")
n2 = input(21, "WT Channel Average Length")

// Overbought/Oversold levels (for visual reference)
MCBobLevel1 = input(60, "WT OB Level 1")
MCBobLevel2 = input(53, "WT OB Level 2")
MCBosLevel1 = input(-60, "WT OS Level 1")
MCBosLevel2 = input(-53, "WT OS Level 2")

// ============================================================================
// WAVE TREND CALCULATION (Exact same as WeloTrades MCB)
// ============================================================================
esa = ta.ema(ap, n1)
d = ta.ema(math.abs(ap - esa), n1)
ci = (ap - esa) / (0.015 * d)
tci = ta.ema(ci, n2)
wt1 = tci
wt2 = ta.sma(wt1, 2)

// ============================================================================
// SIGNAL DETECTION (Exact same logic as WeloTrades MCB lines 189-190)
// ============================================================================
// Green Dot: wt1 crosses above wt2 (bullish cross)
bullishCross = ta.cross(wt1, wt2) and wt2 > wt1

// Red Dot: wt1 crosses below wt2 (bearish cross)  
bearishCross = ta.cross(wt1, wt2) and wt2 < wt1

// ============================================================================
// TRADING LOGIC
// ============================================================================

// Close opposite positions before opening new ones
if bullishCross and strategy.position_size < 0
    strategy.close("Short", comment="Close Short for Long")

if bearishCross and strategy.position_size > 0
    strategy.close("Long", comment="Close Long for Short")

// Long Entry (Green Dot / Bullish Cross)
if bullishCross and strategy.position_size == 0
    strategy.entry("Long", strategy.long, qty=orderSize)
    strategy.exit("Long TP/SL", "Long", 
                  profit=takeProfitTicks, 
                  loss=stopLossTicks,
                  comment_profit="TP Hit",
                  comment_loss="SL Hit")

// Short Entry (Red Dot / Bearish Cross)
if bearishCross and strategy.position_size == 0
    strategy.entry("Short", strategy.short, qty=orderSize)
    strategy.exit("Short TP/SL", "Short", 
                  profit=takeProfitTicks, 
                  loss=stopLossTicks,
                  comment_profit="TP Hit",
                  comment_loss="SL Hit")

// ============================================================================
// VISUAL PLOTS (Same as WeloTrades MCB)
// ============================================================================
// WaveTrend channels
plot(wt1, color=color.rgb(0, 255, 235), linewidth=1, title="WaveTrend 1")
plot(wt2, color=color.rgb(0, 65, 255), linewidth=1, title="WaveTrend 2")

// OB/OS levels
hline(MCBobLevel1, color=color.red, linestyle=hline.style_solid, linewidth=1)
hline(MCBobLevel2, color=color.red, linestyle=hline.style_dotted, linewidth=1)
hline(MCBosLevel1, color=color.green, linestyle=hline.style_solid, linewidth=1)
hline(MCBosLevel2, color=color.green, linestyle=hline.style_dotted, linewidth=1)
hline(0, color=color.gray, linestyle=hline.style_dashed, linewidth=1)

// Signal dots (same style as WeloTrades MCB)
plotshape(bullishCross, title="Green Dot (Buy)", location=location.absolute, 
          color=color.rgb(0, 255, 8), style=shape.circle, size=size.tiny)
plotshape(bearishCross, title="Red Dot (Sell)", location=location.absolute, 
          color=color.rgb(255, 0, 0), style=shape.circle, size=size.tiny)

// Background highlight on entry
bgcolor(bullishCross ? color.new(color.green, 90) : na)
bgcolor(bearishCross ? color.new(color.red, 90) : na)

// ============================================================================
// INFO TABLE
// ============================================================================
var table infoTable = table.new(position.top_right, 2, 5, bgcolor=color.black, border_width=1)
if barstate.islast
    table.cell(infoTable, 0, 0, "Bonzobot MCB", text_color=color.white, bgcolor=color.gray)
    table.cell(infoTable, 1, 0, "Settings", text_color=color.white, bgcolor=color.gray)
    table.cell(infoTable, 0, 1, "Take Profit", text_color=color.gray)
    table.cell(infoTable, 1, 1, str.tostring(takeProfitTicks) + " ticks", text_color=color.green)
    table.cell(infoTable, 0, 2, "Stop Loss", text_color=color.gray)
    table.cell(infoTable, 1, 2, str.tostring(stopLossTicks) + " ticks", text_color=color.red)
    table.cell(infoTable, 0, 3, "Order Size", text_color=color.gray)
    table.cell(infoTable, 1, 3, str.tostring(orderSize) + " BTC", text_color=color.yellow)
    table.cell(infoTable, 0, 4, "WT1 / WT2", text_color=color.gray)
    table.cell(infoTable, 1, 4, str.tostring(wt1, "#.##") + " / " + str.tostring(wt2, "#.##"), text_color=color.aqua)

// ============================================================================
// ALERTS (Compatible with WeloTrades MCB alerts)
// ============================================================================
alertcondition(bullishCross, title="ðŸŸ¢ Bullish Cross (Buy)", message="{{ticker}} ({{interval}}) ðŸŸ¢ Bullish Cross - BUY Signal")
alertcondition(bearishCross, title="ðŸ”´ Bearish Cross (Sell)", message="{{ticker}} ({{interval}}) ðŸ”´ Bearish Cross - SELL Signal")
