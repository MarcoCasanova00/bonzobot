// ============================================================================
// BONZOBOT TRADINGVIEW STRATEGY - Market Cipher B Auto-Trader
// ============================================================================
// This strategy waits for green/red dots from Market Cipher B indicator
// and places orders with fixed TP/SL.
//
// IMPORTANT: This script requires the actual Market Cipher B indicator
// to be on your chart. This script simulates the dot detection logic.
// For real use, you need to integrate with the actual MCB signals.
// ============================================================================

//@version=5
strategy("Bonzobot MCB Auto-Trader", overlay=true, default_qty_type=strategy.fixed, default_qty_value=0.02)

// ============================================================================
// INPUTS
// ============================================================================
takeProfitTicks = input.int(6, "Take Profit (ticks)", minval=1)
stopLossTicks = input.int(4, "Stop Loss (ticks)", minval=1)
orderSize = input.float(0.02, "Order Size (units)", minval=0.001, step=0.001)

// ============================================================================
// MARKET CIPHER B SIMULATION (Replace with actual MCB signals)
// ============================================================================
// Since Market Cipher B is a proprietary indicator, we simulate its logic here.
// This uses a simplified momentum-based approach to generate green/red dots.
// Replace this section with actual MCB signals if you have access.

// Wave Trend calculation (core of MCB)
n1 = input.int(10, "Channel Length")
n2 = input.int(21, "Average Length")

ap = hlc3
esa = ta.ema(ap, n1)
d = ta.ema(math.abs(ap - esa), n1)
ci = (ap - esa) / (0.015 * d)
wt1 = ta.ema(ci, n2)
wt2 = ta.sma(wt1, 4)

// Money Flow (simplified)
mfi = ta.mfi(hlc3, 14)

// Detect oversold/overbought conditions for dots
oversoldLevel = input.int(-60, "Oversold Level")
overboughtLevel = input.int(60, "Overbought Level")

// Green dot: Wave Trend crosses up from oversold + positive momentum
greenDot = ta.crossover(wt1, wt2) and wt2 < oversoldLevel and mfi < 30

// Red dot: Wave Trend crosses down from overbought + negative momentum
redDot = ta.crossunder(wt1, wt2) and wt2 > overboughtLevel and mfi > 70

// ============================================================================
// CALCULATE TP/SL LEVELS
// ============================================================================
// Note: BTCUSD tick size is typically $0.01, but this varies by broker.
// Adjust tickSize if needed for your broker.
tickSize = syminfo.mintick
tpDistance = takeProfitTicks * tickSize
slDistance = stopLossTicks * tickSize

// ============================================================================
// TRADING LOGIC
// ============================================================================

// Close opposite positions before opening new ones
if greenDot and strategy.position_size < 0
    strategy.close("Short", comment="Close Short for Long")

if redDot and strategy.position_size > 0
    strategy.close("Long", comment="Close Long for Short")

// Long Entry (Green Dot)
if greenDot and strategy.position_size == 0
    strategy.entry("Long", strategy.long, qty=orderSize)
    strategy.exit("Long TP/SL", "Long", 
                  profit=takeProfitTicks, 
                  loss=stopLossTicks,
                  comment_profit="TP Hit",
                  comment_loss="SL Hit")

// Short Entry (Red Dot)
if redDot and strategy.position_size == 0
    strategy.entry("Short", strategy.short, qty=orderSize)
    strategy.exit("Short TP/SL", "Short", 
                  profit=takeProfitTicks, 
                  loss=stopLossTicks,
                  comment_profit="TP Hit",
                  comment_loss="SL Hit")

// ============================================================================
// VISUAL FEEDBACK
// ============================================================================
plotshape(greenDot, title="Green Dot (Buy)", location=location.belowbar, 
          color=color.new(color.green, 0), style=shape.circle, size=size.small)
plotshape(redDot, title="Red Dot (Sell)", location=location.abovebar, 
          color=color.new(color.red, 0), style=shape.circle, size=size.small)

// Background color on entry
bgcolor(greenDot ? color.new(color.green, 90) : na)
bgcolor(redDot ? color.new(color.red, 90) : na)

// ============================================================================
// INFO TABLE
// ============================================================================
var table infoTable = table.new(position.top_right, 2, 4, bgcolor=color.black, border_width=1)
if barstate.islast
    table.cell(infoTable, 0, 0, "Setting", text_color=color.white)
    table.cell(infoTable, 1, 0, "Value", text_color=color.white)
    table.cell(infoTable, 0, 1, "Take Profit", text_color=color.gray)
    table.cell(infoTable, 1, 1, str.tostring(takeProfitTicks) + " ticks", text_color=color.green)
    table.cell(infoTable, 0, 2, "Stop Loss", text_color=color.gray)
    table.cell(infoTable, 1, 2, str.tostring(stopLossTicks) + " ticks", text_color=color.red)
    table.cell(infoTable, 0, 3, "Order Size", text_color=color.gray)
    table.cell(infoTable, 1, 3, str.tostring(orderSize) + " BTC", text_color=color.yellow)
